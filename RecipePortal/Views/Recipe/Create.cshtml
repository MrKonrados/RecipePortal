@using System.Web.Mvc
@using Antlr.Runtime.Tree
@using RecipePortal.ViewModels
@model RecipePortal.ViewModels.RecipeViewModel

<h2>New Recipe</h2>

@using (Html.BeginForm("Create", "Recipe", FormMethod.Post, new { enctype = "multipart/form-data" }))
{
    @Html.AntiForgeryToken()
    @Html.ValidationSummary(true, "Please check errors", new { @class = "alert alert-danger", @role = "alert" })

    <div class="form-group @(!ViewData.ModelState.IsValid ? "has-error" : "")">
        @Html.LabelFor(r => r.Name, new { @class = "control-label" })
        @Html.TextBoxFor(r => r.Name, new { @class = "form-control" })
        @Html.ValidationMessageFor(r => r.Name, "", new { @class = "text-danger" })
    </div>

    <div class="form-group @(!ViewData.ModelState.IsValid ? "has-error" : "")"> 
        @Html.Label("Upload File", new { @class = "control-label" }) 
        <input type="file" name="file" required /> 
        @Html.ValidationMessageFor(r => r.File, "", new { @class = "text-danger" }) 
    </div>

    <div id="ingredients">
        @Html.Label("Ingredients:") 
        @if (Model.Ingredients != null)
        {
            foreach (var ingredient in Model.Ingredients)
            {
                @Html.Partial("_Ingredient", ingredient)
            }
        }
        else
        {
            @Html.Partial("_Ingredient", new RecipePortal.Models.Ingredient())
        }
    </div>

    <div class="form-group">
        <a class="btn btn-default btn-xs" id="addIngredient">Add ingredient</a>
    </div>

    <div class="form-group @(!ViewData.ModelState.IsValid ? "has-error" : "")">
        @Html.LabelFor(r => r.Directions, new { @class = "control-label" })
        @Html.TextBoxFor(r => r.Directions, new { @class = "form-control" })
        @Html.ValidationMessageFor(r => r.Directions, "", new { @class = "text-danger" })
    </div>

    <button type="submit" class="btn btn-default">Submit</button>
}

@section scripts {
    <script type="text/javascript">
        var ingredients = '#ingredients';
        $("#addIngredient").on('click',
            function() {
                var url = '/Recipe/AddIngredient/';
                console.log('url: ', url);
                $.ajax({
                    async: true,
                    url: url,
                    success: function(partialView) {
                        $(ingredients).append(partialView);
                    }
                });
            });
    </script>
}